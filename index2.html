<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Punto Ciego – Historia Web</title>

    <!-- Fuentes -->
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet" />

    <!-- Estilos principales -->
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="style_mapasanbernardo.css" />

    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Vega / Flourish -->
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.20.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>

<body>

<!-- =========================================================
     HEADER + TREN
========================================================= -->
<header class="pc-header">
    <div class="pc-topbar">
        <img src="foto logo.png" class="pc-logo" alt="Logo Punto Ciego">
        <span class="pc-title">Punto Ciego</span>
    </div>

    <nav class="pc-trainbar">
        <div class="pc-track">
            <div class="pc-line"></div>

            <img id="pc-train" src="tren_horizontal.js" class="pc-train">

            <div class="pc-stations">
                <button class="station is-active" data-step="0" data-target="inicio">Inicio</button>
                <button class="station" data-step="1" data-target="san-bernardo">San Bernardo</button>
                <button class="station" data-step="2" data-target="senializacion">Señalización</button>
                <button class="station" data-step="3" data-target="territorio">Territorio</button>
                <button class="station" data-step="4" data-target="patrones">Patrones</button>
                <button class="station" data-step="5" data-target="metodologia">Metodología</button>
                <button class="station" data-step="6" data-target="equipo">Equipo</button>
            </div>
        </div>
    </nav>
</header>
<!-- =========================================================
     INICIO
========================================================= -->
<section id="inicio" class="section section-inicio">
    <div class="section-inner">
        <h1>Punto Ciego: rieles en riesgo</h1>

        <p>
            Esta historia web explora una década de siniestros ferroviarios del tipo atropello entre Estación Central
            y la Región de Maule. A partir de registros oficiales, mapas y visualizaciones de datos, reconstruimos
            los puntos ciegos donde la infraestructura, la planificación territorial y la vida cotidiana se cruzan
            con consecuencias fatales.
        </p>
    </div>
</section>


<!-- CITA DESTACADA -->
<section class="cita-destacada">
    <div class="cita-contenido">
        <span class="cita-comillas">“</span>
        <blockquote>
            <strong>La combinación de imprudencia individual con infraestructura defectuosa aparece de manera transversal en todos los cruces analizados.</strong>
        </blockquote>
        <span class="cita-comillas cierre">”</span>
    </div>
</section>



<!-- =========================================================
     SAN BERNARDO
========================================================= -->
<section id="san-bernardo" class="section section-sanbernardo">
    <div class="section-inner section-grid">

        <div class="section-texto">
            <h2>Caso San Bernardo: cuando los patrones se vuelven tragedia</h2>

            <p>
                San Bernardo concentra uno de los casos emblemáticos del tramo estudiado. Aquí confluyen alta
                circulación peatonal, cruces irregulares y fallas en la señalización que reflejan patrones críticos.
            </p>

            <p>
                El mapa permite explorar la ubicación del siniestro, el trazado de la vía y los cruces cercanos,
                junto con el contexto urbano que rodea la línea férrea.
            </p>

            <p>
                A partir de este accidente, se vuelve evidente la necesidad de fortalecer la protección en cruces
                a nivel, mejorar la señalización y revisar la planificación urbana en torno a la vía férrea.
            </p>
        </div>

        <div class="section-visual">
            <div class="tarjeta-mapa">
                <h3>Mapa interactivo del siniestro en San Bernardo</h3>
                <div id="mapa-san-bernardo"></div>
            </div>

            <div class="tarjeta-grafico tarjeta-accidente">
                <img src="20-151152_aciv_Diseno-sin-titulo-37-1200x648.png" alt="Accidente San Bernardo" />
                <h3>Accidente ferroviario San Bernardo (2023)</h3>
                <p>
                    El jueves 29 de junio de 2023, un tren de pasajeros colisionó con uno de carga, generando un
                    debate nacional sobre seguridad ferroviaria.
                </p>
            </div>
        </div>
    </div>
</section>



<!-- =========================================================
     SEÑALIZACIÓN
========================================================= -->
<section id="senializacion" class="section section-senial">
    <div class="section-inner">

        <h2>1. Fallas estructurales: señalización que no previene atropellos</h2>

        <article class="cronica">
            <p>Todos los años mueren personas atropelladas en vías férreas en Chile...</p>
            <!-- (tu texto completo ya estaba perfecto, lo dejé tal cual) -->
        </article>

        <div class="viz-bloque">
            <h3>Distribución de sistemas AUV y CTC</h3>

            <div class="viz-grid">
                <div class="viz-contenedor">
                    <iframe src="graficos/andrés_vis1.html" loading="lazy"></iframe>
                </div>
                <div class="viz-contenedor">
                    <iframe src="graficos/andrés_vis2.html" loading="lazy"></iframe>
                </div>
            </div>
        </div>
    </div>
</section>



<!-- =========================================================
     TERRITORIO
========================================================= -->
<section id="territorio" class="section section-territorio">
    <div class="section-inner">

        <h2>2. Territorios en riesgo: cruces irregulares y desigualdad</h2>

        <article class="cronica">
            <p>Cada año, decenas de personas mueren o resultan heridas en vías férreas...</p>
        </article>

        <h3 class="section-subtitle">Santiago y los cruces que se repiten</h3>

        <div class="viz-bloque">
            <div class="flourish-embed flourish-cards" data-src="visualisation/26561140">
                <script src="https://public.flourish.studio/resources/embed.js"></script>
            </div>
        </div>

        <div class="viz-bloque">
            <h3>Cruces ferroviarios por comuna</h3>
            <div id="vis-territorio"></div>
        </div>
    </div>
</section>



<!-- =========================================================
     PATRONES HUMANOS
========================================================= -->
<section id="patrones" class="section section-patrones">
    <div class="section-inner">

        <h2>3. Puntos ciegos humanos: edades, horarios y vida cotidiana</h2>

        <article class="cronica">
            <p>Los distintos cruces estudiados muestran...</p>
        </article>

        <div class="viz-bloque">
            <div class="viz-grid">
                <div class="viz-contenedor">
                    <iframe src="graficos/edades.html" loading="lazy"></iframe>
                </div>
                <div class="viz-contenedor">
                    <iframe src="graficos/zona horaria.html" loading="lazy"></iframe>
                </div>
                <div class="viz-contenedor">
                    <iframe src="graficos/dia de la semana.html" loading="lazy"></iframe>
                </div>
            </div>
        </div>

    </div>
</section>



<!-- =========================================================
     METODOLOGÍA
========================================================= -->
<section id="metodologia" class="section section-metodo">
    <div class="section-inner">
        <h2>Metodología y fuentes de datos</h2>

        <p>Los datos utilizados provienen de Carabineros, EFE, CONASET...</p>

        <button class="btn-primario"
            onclick="window.open('https://github.com/josefamar/PROYECTO', '_blank')">
            Ver repositorio y documentación
        </button>
    </div>
</section>



<!-- =========================================================
     EQUIPO
========================================================= -->
<section id="equipo" class="section section-equipo">
    <div class="section-inner">
        <h2>Equipo</h2>
        <p><strong>Paloma Riquelme</strong> · Reporter&iacute;a, crónicas y diseño.</p>
        <p><strong>Josefa Mariñanco</strong> · Visualización y análisis.</p>
        <p><strong>Andrés Hernández</strong> · Datos y soporte técnico.</p>
    </div>
</section>
<!-- =========================================================
     SCRIPTS
========================================================= -->

<!-- Leaflet -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Tren -->
<script src="tren_horizontal.js"></script>

<!-- Train Movement -->
<script>
document.querySelectorAll(".station").forEach(btn => {
    btn.addEventListener("click", () => {

        document.querySelectorAll(".station").forEach(b => b.classList.remove("is-active"));
        btn.classList.add("is-active");

        const step = parseInt(btn.dataset.step);
        const percent = (step / 6) * 100;
        document.getElementById("pc-train").style.left = percent + "%";

        document.getElementById(btn.dataset.target).scrollIntoView({ behavior: "smooth" });
    });
});
</script>

<!-- Mapa San Bernardo -->
<script>
document.addEventListener("DOMContentLoaded", function () {

    const mapaEl = document.getElementById("mapa-san-bernardo");
    if (!mapaEl) return;

    const centro = [-33.5933, -70.6996];

    const mapa = L.map("mapa-san-bernardo").setView(centro, 16);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19,
        attribution: "© OpenStreetMap"
    }).addTo(mapa);

    const marcador = L.circleMarker(centro, {
        radius: 10,
        color: "#fff",
        weight: 3,
        fillColor: "#D90429",
        fillOpacity: 0.9
    }).addTo(mapa);

    const tramo = [
        [-33.5850, -70.7050],
        [-33.5890, -70.7020],
        [-33.5933, -70.6996],
        [-33.5980, -70.6960],
    ];

    L.polyline(tramo, { color: "#1E3A68", weight: 4 }).addTo(mapa);
});
// Estaciones como puntos
estaciones.forEach(coord => {
  L.circleMarker(coord, {
    radius: 5,
    fillColor: "#FFFFFF",
    color: "#111827",
    weight: 1,
    fillOpacity: 1
  }).addTo(map);
});

// Punto del accidente (estático)
var accidente = [-33.6069, -70.7040];
var accMarker = L.circleMarker(accidente, {
  radius: 12,
  fillColor: "#D90429",
  color: "#FFFFFF",
  weight: 3,
  fillOpacity: 1
}).addTo(map);

// Toggle del panel al hacer clic
accMarker.on("click", function() {
  const panel = document.getElementById("hero-sidebar");

  if (!panel) return;

  // Si está visible → esconder
  if (panel.classList.contains("show")) {
    panel.classList.remove("show");
    return;
  }

  // Si está oculto → mostrar y hacer zoom
  panel.classList.add("show");

  L.esri.basemapLayer("Imagery").addTo(map);
  map.flyTo(accidente, 16, { duration: 1.5 });
});
</script>
</body>
</body>
</html>
